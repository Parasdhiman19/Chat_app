<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Chat</title>
  </head>
  <body>
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
    <ul id="messages"></ul>

    <script>
      // Use ws:// for local, wss:// for deployed
      const protocol =
        window.location.protocol === "https:" ? "wss://" : "ws://";
      const socket = new WebSocket(
        protocol + window.location.host + "/chat_ws/"
      );

      socket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        const msgList = document.getElementById("messages");

        // If response is a list → first load
        if (Array.isArray(data.response)) {
          msgList.innerHTML = "";
          data.response.forEach((msg) => {
            const li = document.createElement("li");
            li.textContent = msg;
            msgList.appendChild(li);
          });
        } else {
          // If response is a single string → new message
          const li = document.createElement("li");
          li.textContent = data.response;
          msgList.appendChild(li);
        }
      };

      function sendMessage() {
        const input = document.getElementById("messageInput");
        if (input.value.trim() !== "") {
          socket.send(JSON.stringify({ message: input.value }));
          input.value = "";
        }
      }
    </script>
  </body>
</html>
